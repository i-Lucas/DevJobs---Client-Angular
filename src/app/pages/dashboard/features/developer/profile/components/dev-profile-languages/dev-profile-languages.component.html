<dev-profile-panel 
    [icon]="'public'"
    [isOwner]="isOwner"
    [loading]="loading"
    [label]="'Idiomas'"
    (onEdit)="isModalOpen = true"
>

<div class="flex flex-column gap-4 md:pr-4 md:py-2">

    @if (!(languagesList && languagesList.length > 0)) {

        @if (isOwner) {

            <p-button 
                size="small"
                label="Novo"
                icon="pi pi-plus"
                severity="success"
                [loading]="loading || editLoading"
            />
        
        } @else {

            <p class="text-xs">Nenhum registro</p>
        }

    } @else {

        <div class="flex flex-column gap-4">

            @for (language of languagesList; track language; let idx = $index) {

                <span pTooltip={{language.level}} tooltipPosition="bottom">
                    <div class="flex justify-content-between align-items-center gap-3">

                        <span class="font-bold text-2xl">{{language.language}}</span>                   
        
                        <p-rating 
                            [stars]="5"
                            [readonly]="true"
                            [cancel]="false"
                            [(ngModel)]="language.rating"           
                        />

                    </div>
                </span>

                @if (idx < languagesList.length - 1) { 
                    <p-divider styleClass="m-0" />
                }
            }

        </div>
    }

</div>

</dev-profile-panel>

<app-modal 
    [icon]="'public'"
    [loading]="loading"
    [isOpen]="isModalOpen"
    [editLoading]="editLoading"
    [title]="'Editar Idiomas'"
    (onClose)="isModalOpen = !isModalOpen">

    <p-tabView>

        @if(languagesList) {

            @for (currentForm of languagesFormList; track currentForm; let idx = $index) {

                <p-tabPanel header="{{languagesList[idx].language}}">

                    <div class="my-4">

                        <div class="flex justify-content-end">
                            <i  pTooltip="Atualizado em: {{ languagesList[idx].updatedAt | DD_MM_YYYY }}"                                
                                class="material-icons cursor-pointer">help
                            </i>                                                            
                        </div>

                        <app-developer-languages-form
                            [languagesForm]="currentForm"
                        />

                        <div class="flex gap-2 mt-4">
                            <p-button 
                                size="small"
                                label="Salvar" 
                                icon="pi pi-check"
                                [loading]="loading || editLoading"
                                [disabled]="currentForm.invalid || loading || editLoading"
                                (click)="updateLanguage(currentForm)"
                            />
                            <p-button
                                size="small"
                                label="Excluir" 
                                severity="danger"
                                icon="pi pi-trash"
                                [loading]="loading || editLoading"
                                [disabled]="loading || editLoading"
                                (click)="confirmDelete($event, currentForm.value.id)"
                            />
                        </div>
                    </div>
    
                </p-tabPanel>     
            }
        }

    </p-tabView>
</app-modal>